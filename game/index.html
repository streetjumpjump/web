<html ng-app="frogger" ng-controller="Game as game">
<head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>
    <script src="Quintus.js"></script>
    <script src="../ui/app.js"></script>
    <script src="../ui/infoService.js"></script>

    <title>{{ game.info.title }}</title>
</head>
<body>
    <canvas id="quintus" width="250" height="200" style="background-color: #EEE;"></canvas>

    <script>
        (function() {
            'use strict';

            var app = angular.module('frogger');

            app.controller('Game', ['infoService', function(infoService) {
                var vm = this;

                vm.info = infoService;

                var Q = Quintus({
                    development: true
                })
                    .include("Scenes, Sprites, Input, 2D, Touch, UI")
                    .setup("quintus")
                    .controls(true)
                    .touch();

                Q.gravityX = 0;
                Q.gravityY = 0;

                Q.Sprite.extend("Player", {
                    init: function(p) {
                        this._super({
                            asset: localStorage.img ? 'local' : infoService.defaultPath + infoService.player,
                            w: 25,
                            h: 25,
                            x: 100 + 12.5,
                            y: 175 + 12.5
                        });

                        this.add("2d, stepControls");

                        this.on("bump.left,bump.right,bump.bottom, bump.top", function(collision) {
                            if (collision.obj.isA("VictoryZone")) {
                                Q.stageScene("endGame",1, { label: "You Win!" });
                            }
                        });
                    }
                });

                Q.Sprite.extend("VictoryZone", {
                    init: function(p) {
                        this._super({
                            asset: infoService.defaultPath + infoService.victoryZone,
                            w: 250,
                            h: 25,
                            x: 125,
                            y: 12.5
                        });
                    }
                });

                Q.MovingSprite.extend("Enemy", {
                    init: function(p) {
                        this._super({
                            asset: infoService.defaultPath + infoService.enemy,
                            w: 25,
                            h: 25,
                            vx: -30
                        });

                        this.add('2d');

                        this.on("bump.left,bump.right,bump.bottom, bump.top", function(collision) {
                            if (collision.obj.isA("Player")) {
                                Q.stageScene("endGame",1, { label: "You Died" });
                                collision.obj.destroy();
                            }
                        });
                    }
                });

                Q.Sprite.extend("Road", {
                    init: function(p) {
                        this._super(
                            {
                                asset: infoService.defaultPath + infoService.road,
                                w: 250,
                                h: 150,
                                x: 125,
                                y: 125
                            });
                    }
                });

                function start() {
                    Q.scene("level1", function(stage) {
                        var player = stage.insert(new Q.Player());

                        stage.insert(new Q.VictoryZone());

                        var enemies = [];

                        for (var i = 0; i < 5; i++) {
                            enemies.push(stage.insert(new Q.Enemy({ x: 50, y: 50 })));
                        }

                        enemies.forEach(function(enemy, index) {
                            enemy.p.x = 100 + (index * 30);
                            enemy.p.y = 62 + (index * 25);
                        });
                    });

                    Q.scene("roads", function(stage) {
                        stage.insert(new Q.Road());
                    });

                    Q.scene('endGame',function(stage) {
                        var box = stage.insert(new Q.UI.Container({
                            x: Q.width/2, y: Q.height/2, fill: "rgba(0,0,0,0.5)"
                        }));

                        var button = box.insert(new Q.UI.Button({ x: 0, y: 0, fill: "#CCCCCC",
                            label: "Play Again" }));
                        var label = box.insert(new Q.UI.Text({x:10, y: -10 - button.p.h,
                            label: stage.options.label, color: "#fff" }));

                        button.on("click",function() {
                            Q.clearStages();
                            Q.stageScene("roads", 0);
                            Q.stageScene('level1', 1);
                        });

                        box.fit(20);
                    });

                    Q.load([infoService.defaultPath + infoService.victoryZone, infoService.defaultPath + infoService.enemy, infoService.defaultPath + infoService.road, localStorage.img ? 'local' : infoService.defaultPath + infoService.player], function() {
                        Q.stageScene("roads", 0);
                        Q.stageScene("level1", 1);
                    });
                }

                start();
            }]);
        })();
    </script>
</body>
</html>